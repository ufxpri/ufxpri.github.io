ec2 를 구매하는 다양한 방법이 있다. 
on demand
사용하는 만큼 비용이 부과된다. 추가적인 비용은 없지만 중단될 수 없는 중요한 작업이 있을때 사용한다.

reserved instances
니는 72%의 절약된 가격을 제안한다. 1년에서 2년 단위로 계약을 하기 때문에 일정 사용량 이상 고정된 사용량이 예상될때 사용한다.

convertible reserved instance
절약은 가능하지만 인스턴스 종류 변경이 가능하다.

spot instances
가장 절약이 쎈 정책이다. 90%까지 절약이 가능하지만 중단될 수 있기 때문에 짧은 기간동안실행되는 작업에 적합하다.

dedicated hosts

dedicated instance
물리적인서버에 접근할 수있는 권한이 주어진다.

capacity reservations
용량을 예약하고 사용할 수 있다. 


스팟 인스턴스에 대해서 자세히 알아보자
()%까지 절약할 수 있진만 어떤 조건에서 사용해야하는지가 중요하다.

가격이 매우 변동적이다.  

최대 가격을 정해놓고 그 가격이 넘어가게 되면 인스턴스를 중단하는 방식
- 매 시간마다 spot instance 의 가격은 변동됨
- 현제 가격이 사용자 지정 가격보다 높으면 "인스턴스 정지" 와 "인스턴스 종료" 중에 선택할 수 있음. 2분간의 유예기간이 주어짐

스팟블록 - (현재는 없는 기능이지만...)
- 1~6시간동안 사용을 보장받을 수 있음

스팟 인스턴스는 어떻게 종료할까??

스팟 인스턴스는 요청에 의해 동작한다. 사용자가 spot request 를 작성하고 업로드 하면 AWS 는 spot request 를 감시하고 request내용에 따라 instance 를 생성한다.
one-time 의 경우에는 request 가 알아서 종료된다. 그러나 persistant의 경우에는 알아서 죽지 않는다.
그렇기 때문에 instance 를 손으로 종료하더라도 spot request는 여전히 관리 중이기 때문에 인스턴스를 새로 생성하게 된다. 우리는 그것을 원하지 않기 때문에 spot request를 먼저 종료하고 instance를 손으로 정리해야 재실행되는 일 없이 종료할 수 있다.

spot fleets
극강의 절약
스팟 인스턴스와 온디멘드를 합쳐놓은 구성이다.
스팟플릿은 사용자가 요구하는 성능의 가장 최소화된 가격을 제안할것이다.
- 가능한 실행 풀을 정의한다 - 인스턴스 타입, os, AZ
- 여러개의 풀을 가질 수 있어서 fleet이 알아서 선택할 수 있다.
- spot fleet은 설정한 용량에 맞게 차거나 최대 가격에 도달했을때 생성을 멈춘다.

스팟 인스턴스 할당 전략은
- 최저가격 : 최저가격으로 풀을 구성한다 (비용 최적화, 짧은 작업)
- diversified : 모든 풀에 걸쳐 분산됨 (가용성에 좋음, 긴 작업)
- 용량 최적 : 최적의 용량에 맞는 인스턴스와 갯수

따라서 spot fleet 은 알아서 자동으로 최저 가격의 spot instance 를 할당해 준다.