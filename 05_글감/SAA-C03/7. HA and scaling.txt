확장성
수직 확장, 수평 확장

이게 무엇인지 알아보고 예시를 만들어보자

수직 확장은 성능을 높이는 것 이고
수평 확장은 처리량을 높이는 것 이다.

고 가용성
데이터 센터에서 살아남는 것을 목표로 한다.
서버에 장애가 발생하더라도 서비스를 지속할 수 있는것이 바로 고 가용성이다.
고가용성을 위해 여러 지역에 서버를 배치해서 한 AZ에 장애가 발생하더라도 서비스를 우지할 수 있다.

로드벨런싱!
로드벨런서는 여러개의 서버가 있고 이 서버에 요청을 분산하는 작업을 한다.
- ELB 는 AWS 에서 동작을 보장한다.
- 업그레이드 가능하다
- 적은 설정으로 사용 가능하다.

health checks
인스턴스의 서버가 정상적으로 동작하고 있는지 확인하는 요청이다.
로드벨런서는 health checks 신호를 보내 서버가 처리 가능한 상태인지 확인한 후 요청을 보낸다.

종류
classic load balancer - 없어짐!
application load balancer - http
network load balancer - tcp
gatway load balancer - ip

보안사항
유저는 어디서나 load balancer 에 접근할 수 있다.
load balancer 는 80 과 443 만 허용한다.
ec2의 경우 load balancer 로부터 오는 요청만 허용한다.

로드벨런서는 IP 를 클라이언트로 바로 노출시키지 않는다.
실제 클라이언트의 ip 는 X-Forwarded-For 이라는 헤더에 담겨져서 온다. (로그 남길때 주의해야할 듯)
Port 와 Proto 도 알 수 있다. X-Forwarded-Port X-Forwarded-Proto

ALB 는 이 과정을 connection termination 이라고 한다.
ALB 는 L7에서 동작한다.

네트워크 로드 벨런서
L4 에서 동작한다.
매우 고성능이다. ~100ms 정도이다.
가용 영역별로 1개의 IP 를 가진다.
2~3개의 정적 ip 를 노출해야하는 경우 네트워크 로드벨런서가 사용될 수 있다.

target group
EC2가 할당 가능하다. IP 도 할당 가능하다. ALB도 할당 가능하다!!
health checks 로 tcp http https 를 지원한다.

게이트웨이 로드벨런서
L3 에서 동작한다.
가상 어플리케이션의 fleet 관리에 사용된다.
네트워크 레벨에서 엑세스를 분류할 수 있다.
방화벽, 침입 감지 및 예방, 패킷 검사, 부하 조정 등의 역할을 할 수 있다.

투명한 네트워크 게이트웨이 - 모든 트래픽이 하나의 입구와 출구를 가진다.
로드벨런서 - 트래픽을 가상 어플리케이션에 분산한다.
실습에서는 port 6081 에 GENEVE 프로토콜을 사용한다.

도표를 기억하는것이 GWLB 를 이해하는것의 핵심이다.


sticky session (session affinity)
클라이언트의 두번째 요청이 같은 서버로 전달되도록 할 수 있다.
cookie 를 사용하여 이를 구현한다.

2개 종류의 쿠키가 있다.
- application cookie
	- target 에 의해 생성된다.
	- 어플리케이션에서 요구되는 어떤 종류의 속성이라도 포함할 수 있다.
	- cookie 이름은 target group 마다 설정되어야 한다.
	- AWSALB, AWSALBAPP, AWSALBTG 는 ELB에서 사용되고 있음으로 이를 피해서 설정해야 한다.

- duration-based cookie
	- 로드벨런서에 의해 생성된다.
	- 쿠키 이름은 AWSALB 이다.


Cross-Zone Load Balancing
모든 AZ에 부하를 분산할 수 있다.
AZ에 부하가 분산될때는 50대 50으로 분산이 될 텐데 Cross-Zone Load Balancer 가 활성화 되어있다면 불균형한 부하를 다른 AZ로 전송하면서 부하를 맞출 수 있다.

ALB에는 기본적으로 활성화되어 있다.
NLB 나 GWLB 에는 비활성화되어있고 비용이 부과된다.