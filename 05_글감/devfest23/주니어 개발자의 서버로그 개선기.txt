주니어 개발자의 서버로그 개선기

김연희
girls in tech korea

오늘 다룰내용
서버로깅 집중식 로깅 로그 로테이션

로그란!
서버에서 발생한 내역을 기록

로그의 역할이 나오는데
- 사용자 문의 대응
- 에러추적, 재현하기 힘든 버그에 대한 유용한 정보 제공
- 성능에관한 통계와 정보
- 데이터 지표 표출
- 법적 근거

법적으로 기록이 필수인 로그들이 있음

로그를 다루는 과정에서 발생한 어려움이 있었음
- 로그 필터링의 어려움 - 필요한 로그를 보기 힘들었음
- 로그 추적의 어려움 - 로그가 많을 경우 분리해서 확인이 힐들었음
- 방대한 로그용량 - 하루 평균 600mb 의 로그가 작성되고 있었음

이를 어떻게 개선할지 알아보자!

로그는 저장하는 위치를 구분할 수 있다.
로그에는 레벨이 있다.
로그는 레벨을 필터링 할 수 있다.
로그는 패턴이 있다. ISO 8601
MDC? 로깅 프레임워크에서 사용하는 현제 실행되는 쓰레드에 대한 정보르 저장하는곳
이 데이터를 사용해 추적할 수 있는 데이터를 로그에 남길 수 있음 - trace id 포함 가능하다.
로그의 위치를 설정할 수 있다. - 로그의 로거를 만들어 사용하는것과 같다.

로그에는 개인정보가 있으면 안된다. 암호화처리를 하든 해야한다.

그래서 개선을 어떻게 했냐!

grafana loki 

분산환경에서 로그 조회!
grafana 에서 로그 모아보기
- 분산환경 로그 모아보기

loki에서는 로그 검색으로 LogQL 을 사용함
쿼리를 실행하면 보ㅗㄱ싶은 로그르 ㄹ모아볼 수 있음

로그 로테이션은 너무 오래된 로그를 샂게하는 자동화된 프로세스
시간기반, 크기기반, 하이브리드, 압축, 삭제

리눅스 시스템 자체에도 로그 로테이션을 지원한다. 로거 자체에서도 지원하니 관리하기 편한 쪽으로 설정해주면 될 것 같다.

로그필터링의 어려움
- 로그레벨추가
- 중요도에따라 로그파일 분리
로그 추적의어려움
- mdc를 이용한 request로깅
- plg 를 통한 중앙 집중식 로깅
방대한 로그 저장
- 로그로테이션을 설정


향후 알아볼 자료들
OpenTelemetry, tempo 를 활용한 msa 환경 트레이싱
metrc 시각화
실제 운영을 통해 지속적인 개선
데이터분석과 연관된 유의미한 로그 추가